<html>
    <head>
        <title>Familles d'accueil ERA</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

<!---*** Start: JQuery 3.3.1 version. ***--->
<script language="javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!---*** End: JQuery 3.3.1 version. ***--->
<!---*** Start: Bootstrap 3.3.7 version files. ***--->
<script language="javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<!---*** End: Bootstrap 3.3.7 version files. ***--->

<script language="javascript" src="https://momentjs.com/downloads/moment.js"></script>
<script language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.43/js/bootstrap-datetimepicker.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.43/css/bootstrap-datetimepicker.min.css">
    </head>
    <script type="text/javascript">
        function populatecolor(selid) {
            var cols = ["INCONNU", "BEIGE", "BEIGE ET BLANC", "BLANC", "BLUE POINT", "CREME", "ECAILLE DE TORTUE", "GRIS", "GRIS CHARTREUX", "GRIS ET BLANC",
                "NOIR", "NOIR ET BLANC", "NOIR ET SMOKE", "NOIR PLASTRON BLANC", "ROUX", "ROUX ET BLANC", "SEAL POINT", "TABBY BLANC", "TABBY BRUN", "TABBY GRIS",
                "TIGRE", "TIGRE BEIGE", "TIGRE BRUN", "TIGRE CREME", "TIGRE GRIS", "TRICOLORE"];
            var sel, i, option;
            sel = document.getElementById(selid);

            for (i = 0; i < cols.length; ++i) {
                option = document.createElement('option');
                option.value = i;
                option.text = cols[i];
                sel.add(option);
            }
         }
        function populatevets(selid) {
            var vetids = [8, 6, 7];
            var vetnames = ["Veto (commentaires)", "AMCB veterinaires", "Clinique Mont. Verte"];
            var sel, i, option;
            sel = document.getElementById(selid);

            for (i = 0; i < vetids.length; ++i) {
                option = document.createElement('option');
                option.value = vetids[i];
                option.text = vetnames[i];
                sel.add(option);
            }
        }
        window.onload=function() {
            populatecolor("c_color");
            {% if cat.sex %} document.getElementById("c_sex").value = {{ cat.sex }}; {% endif %}
            {% if cat.color %} document.getElementById("c_color").value = {{ cat.color }}; {% endif %}
            {% if cat.longhair %} document.getElementById("c_hlen").value = {{ cat.longhair }}; {% endif %}
            {% if cat.adoptable %} document.getElementById("c_adoptable").value = 1; {% endif %}

            var sel = document.getElementById("sel_FA");
            var i = 0;

            var faid = [  {% for fa in falist %} "{{fa.id}}", {% endfor %} ];
            var fas = [ {% for fa in falist %} "{{fa.FAname}}", {% endfor %} ];
            for (i = 0; i < fas.length; ++i) {
                option = document.createElement('option');
                option.value = faid[i];
                option.text = fas[i];
                sel.add(option);
            }

            populatevets("visit_vet");
            {% for vv in cat.vetvisits %}{% if vv.planned %}
            populatevets("oldv_{{vv.id}}_vet");
            document.getElementById("oldv_{{vv.id}}_vet").value = {{vv.vet_id}};
            {% endif %}{% endfor %}
        }
        $(document).ready(function() {
          $('.datepick').datetimepicker({
            format: 'DD/MM/YY'
        });
        });
        function validateForm() {
            var x = document.forms["c_form"]["c_registre"].value;
            if (!x.match("^[0-9]+-[0-9]+$")) {
                alert("Le numero de registre doit etre de la forme NUMERO-ANNEE");
                return false;
            }
            true;
        }
    </script>
<body>
    <nav class="navbar navbar-inverse">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/self">{{ user.FAid }} ({{ user.FAname }}) [
                {% if user.FAisFA %} FA {% endif %}
                {% if user.FAisOV %} SV {% endif %}
                {% if user.FAisADM %} GR {% endif %} ]
            </a>
        </div>
        <ul class="nav navbar-nav navbar-right">
        {% if current_user.is_authenticated %}
            <li><a href="{{ url_for('logout') }}">Log out</a></li>
        {% else %}
            <li><a href="{{ url_for('login') }}">Log in</a></li>
        {% endif %}
        </ul>
    </div>
    </nav>


    <div class="container">
    {% if msg %}
        {% if msg[0] == 0 %}<div class="alert alert-success">{% endif %}
        {% if msg[0] == 1 %}<div class="alert alert-info">{% endif %}
        {% if msg[0] == 2 %}<div class="alert alert-warning">{% endif %}
        {% if msg[0] == 3 %}<div class="alert alert-danger">{% endif %}
        {{ msg[1] }}</div>
    {% endif %}
    {% if otheruser %} <h2>Situation FA : {{ otheruser.FAname }}</h2> {% endif %}

    <h2>
        {% if cat.registre %}
            {% if cat.name %}
                {{ cat.name }}
            {% else %}
                aucun nom
            {% endif %}
        {% else %}
            Nouveau chat
        {% endif %}
    <small style="font-family:monospace;">({{ cat.vetshort }})</small></h2>

    <form action="cat" id="c_form" onsubmit="return validateForm()" method="POST">
        <input type="hidden" name="catid" value="{{cat.id}}">
        <div class="row form-group">
            <div class="col-sm-1">Registre:</div>
            <div class="col-sm-3">
                {% if cat.registre %} <b>{{ cat.registre }}</b>
                {% else %} <input type="text" name="c_registre" required placeholder="xxx-xx"> {% endif %}
            </div>
            <div class="col-sm-2"><select name="c_adoptable" id="c_adoptable" {% if readonly %}disabled{% endif %}>
                <option value="0">Non adoptable</option>
                <option value="1">Disponible a l'adoption</option></select>
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-1">Nom:</div>
            <div class="col-sm-2">
                {% if cat.name %} <input type="text" name="c_name" oninput="this.value = this.value.toUpperCase()" value="{{ cat.name }}" {% if readonly %}disabled{% endif %}>
                {% else %} <input type="text" name="c_name" oninput="this.value = this.value.toUpperCase()" placeholder="Nom du chat" {% if readonly %}disabled{% endif %}> {% endif %}
            </div>
            <div class="col-sm-1">Identification:</div>
            <div class="col-sm-2">
                {% if cat.identif %} <input type="text" name="c_identif" value="{{ cat.identif }}" {% if readonly %}disabled{% endif %}>
                {% else %} <input type="text" name="c_identif" placeholder="numero de puce" {% if readonly %}disabled{% endif %}> {% endif %}
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-1">Sexe:</div>
            <div class="col-sm-2"><select name="c_sex" id="c_sex"{% if readonly %}disabled{% endif %}>
                <option value="0">INCONNU</option>
                <option value="1">FEMELLE</option>
                <option value="2">MALE</option></select></div>
            <div class="col-sm-1">Naissance:</div>
            <div class="col-sm-2">
                <div class="form-group">
                    <div class="input-group datepick">
                        <input type="text" class="form-control" name="c_birthdate" id="c_birthdate" {% if cat.birthdate %}value="{{ cat.birthdate.strftime("%d/%m/%y") }}"{% else %}placeholder="date de naissance"{% endif %} {% if readonly %}disabled{% endif %}>
                        <div class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-1">Poil:</div>
            <div class="col-sm-2"><select name="c_hlen" id="c_hlen"{% if readonly %}disabled{% endif %}>
                <option value="0">COURT</option>
                <option value="1">MI-LONG</option>
                <option value="2">LONG</option></select></div>
            <div class="col-sm-1">Couleur:</div>
            <div class="col-sm-2"><select name="c_color" id="c_color"{% if readonly %}disabled{% endif %}>
                </select></div>
        </div>

        {% if cat.description %} Description:<div class="form-group"><textarea class="form-control" name="c_description" {% if readonly %}disabled{% endif %}>{{ cat.description }}</textarea></div>
        {% else %} Description:<div class="form-group"><textarea class="form-control" name="c_description" placeholder="Description et/ou signes particuliers" {% if readonly %}disabled{% endif %}></textarea></div> {% endif %}

        {% if cat.registre %}
            <hr>
            <h3>Visites veterinaires</h3>
            {% for vv in cat.vetvisits %}
                {% if vv.planned %}
                <div class="row form-group">
                    Visite veterinaire
                    <select name="oldv_{{vv.id}}_state"><option value="0">Effectuee le</option><option value="1" selected>Planifiee pour le</option></select>
                    <input type="text" name="oldv_{{vv.id}}_date" value="{{vv.vdate.strftime("%d/%m/%y")}}">
                    chez  <select name="oldv_{{vv.id}}_vet" id="oldv_{{vv.id}}_vet"></select>
                </div>
                <div class="row form-group">
                    <label class="checkbox-inline"><input type="checkbox" name="oldv_{{vv.id}}_pv"{% if vv.vtype[0] != '-' %} checked{% endif %}>Primo vaccination</label>
                    <label class="checkbox-inline"><input type="checkbox" name="oldv_{{vv.id}}_r1"{% if vv.vtype[1] != '-' %} checked{% endif %}>1er rappel</label>
                    <label class="checkbox-inline"><input type="checkbox" name="oldv_{{vv.id}}_r2"{% if vv.vtype[2] != '-' %} checked{% endif %}>2eme rappel</label>
                    <label class="checkbox-inline"><input type="checkbox" name="oldv_{{vv.id}}_sc"{% if vv.vtype[3] != '-' %} checked{% endif %}>Sterilisation/Castration</label>
                    <label class="checkbox-inline"><input type="checkbox" name="oldv_{{vv.id}}_id"{% if vv.vtype[4] != '-' %} checked{% endif %}>Identification</label>
                    <label class="checkbox-inline"><input type="checkbox" name="oldv_{{vv.id}}_tf"{% if vv.vtype[5] != '-' %} checked{% endif %}>Test FIV/FelV</label>
                    <label class="checkbox-inline"><input type="checkbox" name="oldv_{{vv.id}}_gen"{% if vv.vtype[6] != '-' %} checked{% endif %}>Soins / autre</label>
                    <label class="checkbox-inline"><input type="checkbox" name="oldv_{{vv.id}}_rr"{% if vv.vtype[7] != '-' %} checked{% endif %}>Rappel annuel</label>
                </div>
                <div class="row form-group">
                    {% if vv.comments %}<textarea class="form-control" name="oldv_{{vv.id}}_comments">{{ vv.comments }}</textarea>
                    {% else %}<textarea class="form-control" name="oldv_{{vv.id}}_comments" placeholder="Commentaires / informations additionnelles"></textarea>{% endif %}
                </div>
                {% else %}
                <div class="row">
                    {{ vv.doneby.FAname }}:
                    effectuee le {{ vv.vdate.strftime("%d/%m/%y") }} aupres de {{ vv.vet.FAname }}
                </div>
                <div class="row">
                    <div class="col-sm-1"></div>
                    {% if vv.vtype[0] != '-' %}- Primo Vaccination {% endif %}
                    {% if vv.vtype[1] != '-' %}- 1er rappel {% endif %}
                    {% if vv.vtype[2] != '-' %}- 2eme rappel {% endif %}
                    {% if vv.vtype[3] != '-' %}- Sterilisation/Castration {% endif %}
                    {% if vv.vtype[4] != '-' %}- Identification {% endif %}
                    {% if vv.vtype[5] != '-' %}- Test FIV/FelV {% endif %}
                    {% if vv.vtype[6] != '-' %}- Soins / autre {% endif %}
                    {% if vv.vtype[7] != '-' %}- Rappel annuel {% endif %}
                </div>
                <div class="row">
                    <div class="col-sm-1"></div>
                    {% if vv.comments %} <div class="col-sm-10">Commentaires: {{ vv.comments }}</div> {% endif %}
                </div>
                {% endif %}
            {% else %}
                <div class="row form-group">Aucune visite enregistree</div>
            {% endfor %}
            {% if not readonly %}
                <hr>
                <div class="row form-group">
                    Nouvelle visite
                        <select name="visit_state"><option value="0">Effectuee le</option><option value="1">Planifiee pour le</option></select>
                        <input type="text" name="visit_date" placeholder="aujourd'hui"> chez
                        <select name="visit_vet" id="visit_vet"></select>--- Sujet de la visite:
                </div>
                <div class="row form-group">
                    <label class="checkbox-inline"><input type="checkbox" name="visit_pv">Primo vaccination</label>
                    <label class="checkbox-inline"><input type="checkbox" name="visit_r1">1er rappel</label>
                    <label class="checkbox-inline"><input type="checkbox" name="visit_r2">2eme rappel</label>
                    <label class="checkbox-inline"><input type="checkbox" name="visit_sc">Sterilisation/Castration</label>
                    <label class="checkbox-inline"><input type="checkbox" name="visit_id">Identification</label>
                    <label class="checkbox-inline"><input type="checkbox" name="visit_tf">Test FIV/FelV</label>
                    <label class="checkbox-inline"><input type="checkbox" name="visit_gen">Soins / autre</label>
                    <label class="checkbox-inline"><input type="checkbox" name="visit_rr">Rappel annuel</label>
                </div>
                <div class="row form-group">
                    <textarea class="form-control" name="visit_comments" placeholder="Commentaires / informations additionnelles"></textarea>
                </div>
            {% endif %}
        {% endif %}

        {% if cat.registre and user.FAisADM %}
            <hr>
            <h3>Historique du chat</h3>
            {% for ev in cat.events %}
                <div class="row">
                    <div class="col-sm-2">{{ ev.edate.strftime("%d/%m/%Y %H:%M") }}</div>
                    <div class="col-sm-10">{{ ev.etext }}</div>
                </div>
            {% else %}
                <div class="row">Aucun evenement</div>
            {% endfor %}
        {% endif %}
        <hr>
        {% if cat.registre %}
        <div class="row form-group">
            {% if readonly %}
            <div class="col-sm-2"><button type="submit" name="action" value="fa_return">Revenir a la liste</button></div>
            {% else %}
            <div class="col-sm-2"><button type="submit" name="action" value="fa_modcat">Mettre a jour les informations et revenir a la liste</button></div>
            <div class="col-sm-2"><button type="submit" name="action" value="fa_modcatr">Mettre a jour les informations et rester sur la page</button></div>
            <div class="col-sm-2"><button type="submit" name="action" value="fa_return">Annuler les changements et revenir a la liste</button></div>
            <div class="col-sm-1"></div>
            <div class="col-sm-2"><button type="submit" name="action" value="fa_adopted">Indiquer que le chat a ete adopte</button></div>
            <div class="col-sm-2"><button type="submit" name="action" value="fa_dead">Indiquer que le chat est decede</button></div>
            {% endif %}
        </div>
        {% if user.FAisADM %}
            <div class="row">
                <button type="submit" name="action" value="adm_putcat">Transferer le chat chez:</button>
                <select id="sel_FA" name="FAid"></select>
        {% endif %}</div>
        {% else %}
        <div class="row">
            Indication rapide des visites veterinaires sans specifier des details:
        </div>
        <div class="row form-group">
            <label class="checkbox-inline"><input type="checkbox" name="visit_pv">Primo vaccination</label>
            <label class="checkbox-inline"><input type="checkbox" name="visit_r1">1er rappel</label>
            <label class="checkbox-inline"><input type="checkbox" name="visit_r2">2eme rappel</label>
            <label class="checkbox-inline"><input type="checkbox" name="visit_sc">Sterilisation/Castration</label>
            <label class="checkbox-inline"><input type="checkbox" name="visit_id">Identification</label>
            <label class="checkbox-inline"><input type="checkbox" name="visit_tf">Test FIV/FelV</label>
        </div>
        <div class="row form-group">
            Une fois les informations remplies:
        </div>
        <div class="row form-group">
            <button type="submit" name="action" value="adm_addcathere">Rajouter le chat chez moi</button>
        </div>
        <div class="row form-group">
             <button type="submit" name="action" value="adm_addcatputFA">Placer le chat chez:</button><select id="sel_FA" name="FAid"></select>
        </div>
        {% endif %}
    </form>

    </div><!-- /.container -->
</body>
</html>
